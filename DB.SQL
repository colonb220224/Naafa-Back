CREATE SCHEMA IF NOT EXISTS NAAFA;

CREATE TABLE IF NOT EXISTS USER
(
    SEQ       BIGINT AUTO_INCREMENT PRIMARY KEY,
    USERNAME  VARCHAR(50) UNIQUE                        NOT NULL,
    PASSWORD  TEXT                                      NULL,
    ROLE      ENUM ('ROLE_USER','ROLE_ADMIN')           NOT NULL DEFAULT 'ROLE_USER',
    PROVIDER  ENUM ('DEFAULT','KAKAO','GOOGLE','NAVER') NOT NULL DEFAULT 'DEFAULT',
    SOCIAL_ID TEXT                                      NULL,
    PHONE     TEXT                                      NOT NULL
);
#유저 기본테이블

CREATE TABLE IF NOT EXISTS USER_TERMS_AGREEMENT
(
    SEQ       BIGINT AUTO_INCREMENT PRIMARY KEY,
    MARKETING BOOLEAN NOT NULL,
    USER      BIGINT  NOT NULL,
    FOREIGN KEY (USER) REFERENCES USER (SEQ)
);
#약관 동의 저장 테이블 - 동의일 저장 정보 필요?

CREATE TABLE IF NOT EXISTS USER_JOIN_INFO
(
    SEQ        BIGINT AUTO_INCREMENT PRIMARY KEY,
    CREATED_AT DATETIME NOT NULL DEFAULT NOW(),
    USER       BIGINT   NOT NULL,
    FOREIGN KEY (USER) REFERENCES USER (SEQ)
);
#유저 가입 로그

CREATE TABLE IF NOT EXISTS USER_STATUS
(
    SEQ    BIGINT AUTO_INCREMENT PRIMARY KEY,
    STATUS ENUM ('NORMAL','DORMANT','WITHDRAWAL'),
    USER   BIGINT NOT NULL,
    FOREIGN KEY (USER) REFERENCES USER (SEQ)
);
#유저 상태 정보

CREATE TABLE IF NOT EXISTS USER_DORMANT_INFO
(
    SEQ        BIGINT AUTO_INCREMENT PRIMARY KEY,
    DORMANT_AT DATETIME NOT NULL DEFAULT NOW(),
    USER       BIGINT   NOT NULL,
    FOREIGN KEY (USER) REFERENCES USER (SEQ)
);
#휴면 정보

CREATE TABLE IF NOT EXISTS USER_WITHDRAWAL_INFO
(
    SEQ           BIGINT AUTO_INCREMENT PRIMARY KEY,
    WITHDRAWAL_AT DATETIME NOT NULL DEFAULT NOW(),
    USER          BIGINT   NOT NULL,
    FOREIGN KEY (USER) REFERENCES USER (SEQ)
);
#탈퇴 정보

CREATE TABLE IF NOT EXISTS USER_PHONE_AUTH
(
    SEQ  BIGINT AUTO_INCREMENT PRIMARY KEY,
    DI   TEXT   NOT NULL,
    CI   TEXT   NOT NULL,
    USER BIGINT NOT NULL,
    FOREIGN KEY (USER) REFERENCES USER (SEQ)
);
#휴대폰 인증값

CREATE TABLE IF NOT EXISTS USER_ROLE_DETAILS
(
    SEQ       BIGINT AUTO_INCREMENT PRIMARY KEY,
    USER_ROLE ENUM ('HOSPITAL_MASTER','HOSPITAL_MANAGER','PATIENT'),
    USER      BIGINT NOT NULL,
    FOREIGN KEY (USER) REFERENCES USER (SEQ)
);
#일반 유저 분류 (병원 대표 관리자/병원 관리자/환자)

CREATE TABLE IF NOT EXISTS ADMIN_ROLE_DETAILS
(
    SEQ        BIGINT AUTO_INCREMENT PRIMARY KEY,
    ADMIN_ROLE ENUM ('MASTER','MANAGER'),
    USER       BIGINT NOT NULL,
    FOREIGN KEY (USER) REFERENCES USER (SEQ)
);
#어드민 유저 분류 (마스터 관리자/일반 관리자)


CREATE TABLE IF NOT EXISTS HOSPITAL
(
    SEQ        BIGINT AUTO_INCREMENT PRIMARY KEY,
    NAME       TEXT   NOT NULL,
    ADDRESS    TEXT   NOT NULL,
    COORDINATE POINT  NOT NULL,
    CONTACT    TEXT   NOT NULL,
    USER       BIGINT NOT NULL,
    FOREIGN KEY (USER) REFERENCES USER (SEQ)
);
#병원 기본정보

CREATE TABLE IF NOT EXISTS USER_HOSPITAL_RELATE
(
    SEQ      BIGINT AUTO_INCREMENT PRIMARY KEY,
    USER     BIGINT  NOT NULL,
    HOSPITAL BIGINT  NOT NULL,
    HOST     BOOLEAN NOT NULL,
    FOREIGN KEY (USER) REFERENCES USER (SEQ),
    FOREIGN KEY (HOSPITAL) REFERENCES HOSPITAL (SEQ)
);
#병원 소속 정보 / 대표관리자인 경우 HOST 컬럼 TRUE


CREATE TABLE IF NOT EXISTS HOSPITAL_CHIEF
(
    SEQ            BIGINT AUTO_INCREMENT PRIMARY KEY,
    CHIEF_NAME     TEXT                          NOT NULL,
    LICENSE_NUMBER TEXT                          NOT NULL,
    CHIEF_CATEGORY ENUM ('GENERAL','SPECIALIST') NOT NULL,
    SEX            ENUM ('MALE','FEMALE')        NOT NULL,
    HOSPITAL BIGINT NOT NULL,
    FOREIGN KEY (HOSPITAL) REFERENCES HOSPITAL (SEQ)
);
#병원 원장 정보


CREATE TABLE IF NOT EXISTS HOSPITAL_INFO
(
    SEQ          BIGINT AUTO_INCREMENT PRIMARY KEY,
    HOSPITAL     BIGINT NOT NULL,
    INFO_SIMPLE  TEXT   NOT NULL,
    INFO_DETAILS TEXT   NOT NULL,
    INFO_PARKING TEXT   NOT NULL,
    FOREIGN KEY (HOSPITAL) REFERENCES HOSPITAL (SEQ)
);
#병원 상세 정보

CREATE TABLE IF NOT EXISTS HOSPITAL_REVIEW_TYPE
(
    SEQ  BIGINT AUTO_INCREMENT PRIMARY KEY,
    TYPE TEXT NOT NULL
);
#리뷰 타입

INSERT INTO HOSPITAL_REVIEW_TYPE (TYPE)
VALUES ('KIND CONSULT'),
       ('DETAIL DESC'),
       ('KIND DESC');
#친절하게 상담해주셨어요 / 자세히 설명해 주셨어요 / 친절하게 설명해 주셨어요

CREATE TABLE IF NOT EXISTS HOSPITAL_REVIEW
(
    SEQ             BIGINT AUTO_INCREMENT PRIMARY KEY,
    CONTENTS        TEXT     NOT NULL,
    SCORE           TINYINT  NOT NULL,
    REVISIT_WILLING BOOLEAN  NOT NULL,
    HOSPITAL        BIGINT   NOT NULL,
    USER            BIGINT   NOT NULL,
    TYPE            BIGINT   NOT NULL,
    RECEIPT         TEXT     NULL,
    CREATED_AT      DATETIME NOT NULL DEFAULT NOW(),
    MODIFIED_AT     DATETIME NOT NULL DEFAULT NOW() ON UPDATE NOW(),
    FOREIGN KEY (HOSPITAL) REFERENCES HOSPITAL (SEQ),
    FOREIGN KEY (USER) REFERENCES USER (SEQ),
    FOREIGN KEY (TYPE) REFERENCES HOSPITAL_REVIEW_TYPE (SEQ)
);
#병원 리뷰 / RECEIPT 영수증 인증관련하여 설명이 없으므로 일단 TEXT 로 설정해둔뒤 비워둠


/*
  병원 추가 필요 항목
  기획서 예약 서비스 제공 항목 요일별 운영시간 - 기획서상 요일별 항목 존재 X
  진료 서비스 제공 항목 - 해당 데이터의 사용처를 알 수 없음 (기획 의도 필요)
  진료 과목 / 진료 항목 데이터필요 - 기획서상 존재 X
  초진 예약 가능 여부 - 유저 페이지엔 존재하나 어드민상 존재 X
*/

/*
  유저 추가 필요 항목
  회원정보 수정에서 생년월일은 어디서 튀어나온건지 - 회원가입시 휴대폰 인증을 본인인증으로 대체시에 문제 X
  주민등록번호는 암호화 저장하는데, 마이페이지에서는 7자리까지 확인가능 - 해당 부분 고려 필요
*/



CREATE TABLE IF NOT EXISTS PATIENT_INFO
(
    SEQ           BIGINT AUTO_INCREMENT PRIMARY KEY,
    NAME          VARCHAR(20) NOT NULL,
    SOCIAL_NUMBER TEXT        NOT NULL,
    RELATE        ENUM ('SELF','SPOUSE','DAUGHTER','SON','FATHER','MOTHER'),
    USER          BIGINT      NOT NULL,
    FOREIGN KEY (USER) REFERENCES USER (SEQ)
);
#개인정보 / 주민등록번호는 AES256 으로 암호화하여 저장 예정


CREATE TABLE IF NOT EXISTS INQUIRY_TYPE
(
    SEQ  BIGINT AUTO_INCREMENT PRIMARY KEY,
    TYPE TEXT NOT NULL
);
# 1:1문의 유형

CREATE TABLE IF NOT EXISTS INQUIRY
(
    SEQ        BIGINT AUTO_INCREMENT PRIMARY KEY,
    TITLE      TEXT   NOT NULL,
    CONTENTS   TEXT   NOT NULL,
    USER       BIGINT NOT NULL,
    CREATED_AT DATETIME DEFAULT NOW(),
    FOREIGN KEY (USER) REFERENCES USER (SEQ)
);
# 1:1 문의

CREATE TABLE IF NOT EXISTS INQUIRY_ANSWER
(
    SEQ        BIGINT AUTO_INCREMENT PRIMARY KEY,
    CONTENTS   TEXT   NOT NULL,
    USER       BIGINT NOT NULL,
    CREATED_AT DATETIME DEFAULT NOW(),
    FOREIGN KEY (USER) REFERENCES USER (SEQ)
);
# 1:1 문의 답변


CREATE TABLE IF NOT EXISTS HOSPITAL_BUSINESS_HOURS_MONDAY
(
    SEQ      BIGINT AUTO_INCREMENT PRIMARY KEY,
    START_AT TINYINT(1) NOT NULL,
    END_AT   TINYINT(1),
    HOSPITAL BIGINT     NOT NULL,
    FOREIGN KEY (HOSPITAL) REFERENCES HOSPITAL (SEQ)
);

CREATE TABLE IF NOT EXISTS HOSPITAL_BUSINESS_HOURS_TUESDAY
(
    SEQ      BIGINT AUTO_INCREMENT PRIMARY KEY,
    START_AT TINYINT(1) NOT NULL,
    END_AT   TINYINT(1),
    HOSPITAL BIGINT     NOT NULL,
    FOREIGN KEY (HOSPITAL) REFERENCES HOSPITAL (SEQ)
);

CREATE TABLE IF NOT EXISTS HOSPITAL_BUSINESS_HOURS_WEDNESDAY
(
    SEQ      BIGINT AUTO_INCREMENT PRIMARY KEY,
    START_AT TINYINT(1) NOT NULL,
    END_AT   TINYINT(1),
    HOSPITAL BIGINT     NOT NULL,
    FOREIGN KEY (HOSPITAL) REFERENCES HOSPITAL (SEQ)
);

CREATE TABLE IF NOT EXISTS HOSPITAL_BUSINESS_HOURS_THURSDAY
(
    SEQ      BIGINT AUTO_INCREMENT PRIMARY KEY,
    START_AT TINYINT(1) NOT NULL,
    END_AT   TINYINT(1),
    HOSPITAL BIGINT     NOT NULL,
    FOREIGN KEY (HOSPITAL) REFERENCES HOSPITAL (SEQ)
);

CREATE TABLE IF NOT EXISTS HOSPITAL_BUSINESS_HOURS_FRIDAY
(
    SEQ      BIGINT AUTO_INCREMENT PRIMARY KEY,
    START_AT TINYINT(1) NOT NULL,
    END_AT   TINYINT(1),
    HOSPITAL BIGINT     NOT NULL,
    FOREIGN KEY (HOSPITAL) REFERENCES HOSPITAL (SEQ)
);

CREATE TABLE IF NOT EXISTS HOSPITAL_BUSINESS_HOURS_SATURDAY
(
    SEQ      BIGINT AUTO_INCREMENT PRIMARY KEY,
    START_AT TINYINT(1) NOT NULL,
    END_AT   TINYINT(1),
    HOSPITAL BIGINT     NOT NULL,
    FOREIGN KEY (HOSPITAL) REFERENCES HOSPITAL (SEQ)
);

CREATE TABLE IF NOT EXISTS HOSPITAL_BUSINESS_HOURS_SUNDAY
(
    SEQ      BIGINT AUTO_INCREMENT PRIMARY KEY,
    START_AT TINYINT(1) NOT NULL,
    END_AT   TINYINT(1),
    HOSPITAL BIGINT     NOT NULL,
    FOREIGN KEY (HOSPITAL) REFERENCES HOSPITAL (SEQ)
);

CREATE TABLE IF NOT EXISTS HOSPITAL_BUSINESS_HOURS_BREAK
(
    SEQ      BIGINT AUTO_INCREMENT PRIMARY KEY,
    START_AT TINYINT(1) NOT NULL,
    END_AT   TINYINT(1),
    HOSPITAL BIGINT     NOT NULL,
    FOREIGN KEY (HOSPITAL) REFERENCES HOSPITAL (SEQ)
);

CREATE TABLE IF NOT EXISTS HOSPITAL_EMPLOYEE_INFO
(
    SEQ        BIGINT AUTO_INCREMENT PRIMARY KEY,
    TYPE       ENUM ('실무') NOT NULL,
    DEPARTMENT TEXT        NOT NULL,
    GRADE      TEXT        NOT NULL,
    USER       BIGINT      NOT NULL,
    FOREIGN KEY (USER) REFERENCES USER (SEQ)
);
#소속직원 정보 / 기획 미흡으로 미완성

